(()=>{"use strict";const e=window.React,t=window.wp.components,a=window.wp.i18n,n=window.wp.element,s=({color:a,onChange:s,confirm:l,size:c="def"})=>{const[o,r]=(0,n.useState)(a),[m,i]=(0,n.useState)(!1),u=["wc_swatch_color sasw_border"];return u.push(c),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:u.join(" ")},(0,e.createElement)("div",{style:{background:o,pointer:"cursor"},onClick:()=>{i(!0)}}),m&&(0,e.createElement)(t.Popover,{className:"wc_swatch_color_picker",placement:"left-start",offset:15,noArrow:!1,onClose:()=>{i(!1)}},(0,e.createElement)(t.ColorPicker,{color:o,onChange:e=>{r(e),s?.(e)}}))))},l=({value:a,onChange:l,confirm:c})=>{const[o,r]=(0,n.useState)((()=>{const e=a?.more?.map?.((e=>({v:e||"",t:Date.now()})));return[{v:a?.value||"",t:Date.now()},...e||[]]})),[m,i]=(0,n.useState)(!1),[u,d]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{let e=null;return m&&(e=setTimeout((()=>{console.log("Call_Change___");const e={...a,value:""};if(o?.length&&(e.value=o[0].v),o?.length>1){e.more=[],e.value=o[0].v;for(let t=1;t<o.length;t++)e.more.push(o[t].v)}l?.(e)}),600)),()=>{e&&clearTimeout(e)}}),[m]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:""},(0,e.createElement)("div",{className:"wc_swatch_colors sasw_space sasw_wrap",onClick:()=>{d(!u)}},(0,e.createElement)("span",{className:"sasw_swatch"},(0,e.createElement)("span",{className:"sasw_color_inner"},o.map((t=>(0,e.createElement)("span",{className:"sasw_color_item",style:{background:t.v,pointer:"cursor"}})))))),u&&(0,e.createElement)(t.Modal,{title:"Select Color",className:"sasw_swatch_modal",onClickOutside:()=>{d(!1)},onRequestClose:()=>{d(!1)},headerActions:(0,e.createElement)("div",{className:"sasw_space"},(0,e.createElement)("button",{className:"button",onClick:e=>{i(Date.now()),r((e=>[...e,{t:Date.now(),v:""}]))}},"Add"))},(0,e.createElement)("div",{className:"sasw_space sasw_wrap"},o.map(((t,a)=>(0,e.createElement)("div",{key:t.t,className:"color_item"},(0,e.createElement)(s,{size:"x2",color:t.v||"",onChange:e=>{i(Date.now()),r((t=>{const n=[...t];return n[a].v=e,n}))}}),(0,e.createElement)("span",{className:"ic remove",onClick:()=>{i(Date.now()),r((e=>{if(e?.length<2)return e;const t=[...e];return t.splice(a,1),t}))}},(0,e.createElement)("span",{className:"dashicons dashicons-no-alt"})))))))))},c=({value:s,type:l,onChange:c,clear:o})=>{var r;const[m,i]=(0,n.useState)(s||{}),u=(0,n.useMemo)((()=>{const e=wp.media({title:"Select Image",button:{text:"Use this image"},multiple:!1,library:{type:["image"]}});return e.on("select",(function(){var e=u.state().get("selection").first().toJSON();const t={};e.sizes?.thumbnail?.url&&(t.thumbnail=e.sizes?.thumbnail?.url),e.sizes?.full?.url&&(t.full=e.sizes?.full?.url);const a={id:e.id,...t};i(a),c?.(a)})),e}),[]),d=()=>{u.open()};(0,n.useEffect)((()=>{o&&jQuery(window).on("taxonomy_term_added",((e,t)=>{const a=t?.responses?.[1]?.supplemental?.term_id;console.log("Tax_added",a,t),i(null),c?.(null)}))}),[]);const _=null!==(r=m?.thumbnail)&&void 0!==r?r:m?.full;return(0,e.createElement)("div",{className:"wc_swatch_image_wrap","data-type":l},(0,e.createElement)("div",{onClick:d,className:"wc_swatch_image"},_?(0,e.createElement)("img",{src:_,alt:""}):(0,e.createElement)("span",{className:"wc_swatch_image_placeholder"},(0,e.createElement)("span",{class:"dashicons dashicons-format-image"}))),"full"===l?(0,e.createElement)("div",{className:"act"},(0,e.createElement)(t.Button,{size:"small",onClick:d,variant:"secondary"},(0,a.__)("Upload","sa-swatches")),(0,e.createElement)(t.Button,{onClick:()=>{i(!1),c?.(!1)},isDestructive:!0,size:"small",variant:"secondary"},(0,a.__)("Remove","sa-swatches"))):null)},o=({data:t,term_id:a})=>{const n=e=>{console.log("onChange__col",e);let t={...SASW_SWATCHES.current_tax,...e,term_id:a};"sasw_image"===t?.type&&(t.value=e?.id),(({url:e,path:t,method:a,data:n,body:s,params:l})=>new Promise(((c,o)=>{let r=e||window?.SASW_SWATCHES?.root+t;const m={method:a||"get",cache:"no-cache",headers:{"Content-Type":"application/json","X-WP-Nonce":window?.SASW_SWATCHES?.nonce},redirect:"follow"};if(n&&(m.body=JSON.stringify(n)),s&&(m.body=JSON.stringify(s)),l){const e=new URLSearchParams(l||{}).toString();e.length&&(r?.includes("?")?r+="&"+e:r+="?"+e)}fetch(r,m).then((e=>e.json())).then((e=>c(e))).catch((e=>o(e)))})))({url:SASW_SWATCHES?.ajax,method:"post",data:t,params:{endpoint:"update_term_swatch"}}).then((e=>{console.log("Update_meta",e)})).catch((e=>console.log(e)))};return(0,e.createElement)(e.Fragment,null,"sasw_image"===SASW_SWATCHES?.current_tax?.type?(0,e.createElement)(c,{value:t,onChange:n}):null,"sasw_color"===SASW_SWATCHES?.current_tax?.type?(0,e.createElement)(l,{confirm:!0,onChange:n,value:t}):null)},r=document.getElementById("sasw_attr_swatch_el"),m=document.createElement("div");r.append(m),(0,n.render)((0,e.createElement)((()=>{const t=e=>{console.log("onChange",e),jQuery("input#sasw_attr_swatch").val(JSON.stringify({...e,type:SASW_SWATCHES?.current_tax?.type}))};return(0,e.createElement)("div",{className:"sasw_attr_main"},"sasw_image"===SASW_SWATCHES?.current_tax?.type?(0,e.createElement)(c,{value:window.SASW_SWATCHES?.current_term,clear:!0,autoSave:!1,onChange:t,type:"full"}):null,"sasw_color"===SASW_SWATCHES?.current_tax?.type?(0,e.createElement)(l,{value:window.SASW_SWATCHES?.current_term,onChange:t}):null)}),null),m);const i=t=>{const a=t.data("swatch"),s=t.data("term_id");t.addClass("sasw_added"),(0,n.render)((0,e.createElement)(o,{data:a,term_id:s}),t.get(0))};jQuery(".sasw_swatch").each((function(){const e=jQuery(this);i(e)})),jQuery(window).on("taxonomy_term_added",((e,t)=>{console.log("New term added"),jQuery(".sasw_swatch").not(".sasw_added").each((function(){const e=jQuery(this);i(e)}))}))})();